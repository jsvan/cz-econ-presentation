<!-- SLIDE: ENERGY -->
<div class="slide-content">
    <div class="section-number">04</div>
    <div class="section-label">Nejen káva</div>
    <h2>Česká Energetická Infrastruktura</h2>
    <br/>
    <div style="display: flex; gap: 1rem;">
        <div class="chart-container" style="flex: 1;">
            <div class="chart-title">Kolik Stojí Energie? (EUR/kWh) — <a href="https://ec.europa.eu/eurostat/databrowser/view/ten00117/default/table" target="_blank" style="color: var(--accent-gold);">Eurostat</a></div>
            <div class="chart-wrapper">
                <canvas id="energyPricesChart"></canvas>
            </div>
        </div>
        <div class="chart-container" style="flex: 1;">
            <div class="chart-title">Kolik Energie Člověk Potřebuje (MWh/osobu) — <a href="https://ember-energy.org/latest-insights/european-electricity-review-2024/" target="_blank" style="color: var(--accent-gold);">Ember</a></div>
            <div class="chart-wrapper">
                <canvas id="energyConsumptionChart"></canvas>
            </div>
        </div>
    </div>
    <div class="chart-container">
        <div class="chart-title">Zdroje Energie 2024 (%) — <a href="https://lowcarbonpower.org" target="_blank" style="color: var(--accent-gold);">Zelená Energie</a></div>
        <div style="display: flex; justify-content: space-around; align-items: flex-start; gap: 1rem; padding: 1rem 0;">
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-gold);">Německo</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixGermany"></canvas>
                </div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-blue);">Česko</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixCzechia"></canvas>
                </div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: #c75050;">Polsko</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixPoland"></canvas>
                </div>
            </div>
        </div>
        <div style="display: flex; justify-content: center; gap: 3rem; margin-top: 0.5rem; font-size: 0.9rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="display: inline-block; width: 14px; height: 14px; background: linear-gradient(135deg, #7f1d1d, #991b1b); border-radius: 3px;"></span>
                <span style="color: var(--text-secondary);">Fosilní paliva</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="display: inline-block; width: 14px; height: 14px; background: linear-gradient(135deg, #3b82f6, #6fb3fc); border-radius: 3px;"></span>
                <span style="color: var(--text-secondary);">Nízkouhlíková</span>
            </div>
        </div>
    </div>
    <div class="map-container">
        <div class="chart-title">Energetické továrny — <a href="https://www.cez.cz/en/energy-generation" target="_blank" style="color: var(--accent-gold);">ČEZ</a></div>
        <svg viewBox="0 0 612.46 350.62" xmlns="http://www.w3.org/2000/svg">
            <!-- Czech Republic base map -->
            <image href="https://jsvan.github.io/cz-econ-presentation/czech-republic.svg" width="612.46" height="350.62"/>

            <!-- ALL SHAPES FIRST (so text renders on top) -->

            <!-- COAL PLANTS (red regions) -->
            <!-- North Bohemian Basin (Most/Chomutov area) -->
            <ellipse cx="125" cy="85" rx="50" ry="20" fill="#7f1d1d" opacity="0.4"/>
            <!-- Sokolov coal (Karlovarský region) -->
            <ellipse cx="50" cy="122" rx="18" ry="10" fill="#7f1d1d" opacity="0.3"/>
            <!-- Ostrava/Dětmarovice coal (Moravskoslezský far east) -->
            <ellipse cx="560" cy="175" rx="22" ry="14" fill="#7f1d1d" opacity="0.3"/>
            <!-- Mělník coal/biomass (north of Prague) -->
            <circle cx="216" cy="99" r="10" fill="#7f1d1d" opacity="0.4"/>
            <circle cx="216" cy="99" r="4" fill="#7f1d1d"/>

            <!-- NUCLEAR (green-teal) -->
            <!-- Dukovany -->
            <circle cx="367" cy="276" r="18" fill="#10b981" opacity="0.5"/>
            <circle cx="367" cy="276" r="8" fill="#10b981"/>
            <!-- Temelín -->
            <circle cx="207" cy="262" r="18" fill="#10b981" opacity="0.5"/>
            <circle cx="207" cy="262" r="8" fill="#10b981"/>

            <!-- PUMPED HYDRO (blue) -->
            <!-- Dlouhé Stráně -->
            <circle cx="460" cy="136" r="12" fill="#3b82f6" opacity="0.5"/>
            <circle cx="460" cy="136" r="5" fill="#3b82f6"/>
            <!-- Dalešice (near Dukovany) -->
            <circle cx="363" cy="269" r="10" fill="#3b82f6" opacity="0.4"/>
            <circle cx="363" cy="269" r="4" fill="#3b82f6"/>

            <!-- VLTAVA CASCADE (blue line with reservoir dots) -->
            <path d="M212,145 Q200,190 185,230 Q170,270 155,310" stroke="#3b82f6" stroke-width="2" fill="none" opacity="0.5"/>
            <!-- Lipno (southernmost, largest reservoir) -->
            <circle cx="155" cy="310" r="6" fill="#3b82f6" opacity="0.5"/>
            <circle cx="155" cy="310" r="3" fill="#3b82f6"/>
            <!-- Orlík (deepest dam) -->
            <circle cx="175" cy="255" r="5" fill="#3b82f6" opacity="0.5"/>
            <circle cx="175" cy="255" r="2.5" fill="#3b82f6"/>
            <!-- Slapy -->
            <circle cx="195" cy="205" r="4" fill="#3b82f6" opacity="0.4"/>
            <circle cx="195" cy="205" r="2" fill="#3b82f6"/>
            <!-- Štěchovice -->
            <circle cx="205" cy="175" r="3" fill="#3b82f6" opacity="0.4"/>
            <circle cx="205" cy="175" r="1.5" fill="#3b82f6"/>
            <!-- Vrané (closest to Prague) -->
            <circle cx="210" cy="160" r="3" fill="#3b82f6" opacity="0.4"/>
            <circle cx="210" cy="160" r="1.5" fill="#3b82f6"/>

            <!-- WIND (light purple/lavender) -->
            <!-- Kryštofovy Hamry (Ore Mountains) -->
            <circle cx="90" cy="60" r="8" fill="#a855f7" opacity="0.5"/>
            <circle cx="90" cy="60" r="3" fill="#a855f7"/>
            <!-- Northern wind region (Liberecký) -->
            <circle cx="268" cy="40" r="6" fill="#a855f7" opacity="0.4"/>
            <circle cx="268" cy="40" r="2" fill="#a855f7"/>
            <!-- Olomouc wind area -->
            <circle cx="467" cy="205" r="5" fill="#a855f7" opacity="0.3"/>
            <circle cx="467" cy="205" r="2" fill="#a855f7"/>

            <!-- SOLAR (yellow) -->
            <!-- Ralsko (former military base, Liberecký) -->
            <circle cx="250" cy="75" r="10" fill="#eab308" opacity="0.5"/>
            <circle cx="250" cy="75" r="4" fill="#eab308"/>
            <!-- Brno area solar -->
            <circle cx="409" cy="261" r="6" fill="#eab308" opacity="0.4"/>
            <circle cx="409" cy="261" r="2" fill="#eab308"/>

            <!-- Prague marker -->
            <circle cx="212" cy="137" r="4" fill="#fff"/>

            <!-- ALL TEXT LAST (renders on top of shapes) -->

            <!-- Coal plant labels -->
            <text x="125" y="68" fill="#ef4444" font-size="10" text-anchor="middle" font-weight="bold">Uhelné elektrárny</text>
            <text x="125" y="82" fill="#fff" font-size="8" text-anchor="middle">Prunéřov, Tušimice</text>
            <text x="125" y="94" fill="#fff" font-size="8" text-anchor="middle">Počerady, Ledvice</text>
            <text x="50" y="140" fill="#fff" font-size="8" text-anchor="middle">Tisová</text>
            <text x="560" y="195" fill="#fff" font-size="8" text-anchor="middle">Dětmarovice</text>
            <text x="231" y="97" fill="#fff" font-size="9">Mělník</text>

            <!-- Nuclear labels -->
            <text x="367" y="257" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Dukovany</text>
            <text x="367" y="303" fill="#10b981" font-size="8" text-anchor="middle">2000 MW (4 reactors)</text>
            <text x="207" y="243" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Temelín</text>
            <text x="207" y="289" fill="#10b981" font-size="8" text-anchor="middle">2000 MW (2 reactors)</text>

            <!-- Hydro labels -->
            <text x="460" y="119" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Dlouhé Stráně</text>
            <text x="460" y="156" fill="#3b82f6" font-size="8" text-anchor="middle">650 MW pumped</text>
            <text x="348" y="257" fill="#fff" font-size="9" text-anchor="middle">Dalešice</text>
            <text x="140" y="315" fill="#fff" font-size="8" text-anchor="end">Lipno</text>
            <text x="160" y="260" fill="#fff" font-size="8" text-anchor="end">Orlík</text>
            <text x="180" y="203" fill="#fff" font-size="7" text-anchor="end">Slapy</text>
            <text x="228" y="163" fill="#3b82f6" font-size="8" font-weight="bold">Vltava</text>
            <text x="228" y="173" fill="#3b82f6" font-size="8" font-weight="bold">kaskáda</text>

            <!-- Wind labels -->
            <text x="90" y="45" fill="#fff" font-size="9" text-anchor="middle">Kryštofovy H.</text>

            <!-- Solar labels -->
            <text x="250" y="60" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Ralsko</text>
            <text x="250" y="93" fill="#eab308" font-size="8" text-anchor="middle">56 MW solar</text>

            <!-- City labels -->
            <text x="212" y="127" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Praha</text>
        </svg>
        <div class="map-legend" style="display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem;">
            <div class="legend-item"><div class="legend-dot" style="background: #10b981;"></div>Jaderná — 41%</div>
            <div class="legend-item"><div class="legend-dot" style="background: #7f1d1d;"></div>Uhlí — 34%</div>
            <div class="legend-item"><div class="legend-dot" style="background: #3b82f6;"></div>Voda — Dlouhé Stráně a Vltava kaskáda</div>
            <div class="legend-item"><div class="legend-dot" style="background: #eab308;"></div>Slunce — 7%</div>
            <div class="legend-item"><div class="legend-dot" style="background: #a855f7;"></div>Vítr — ~1%</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin: 2rem 0;">
        <div style="display: flex; align-items: center; justify-content: center;">
            <img src="https://jsvan.github.io/cz-econ-presentation/img/dlouhestrane.jpg" alt="Dlouhé Stráně upper reservoir" style="max-width: 100%; object-fit: contain; border-radius: 4px;">
        </div>
        <div style="display: flex; align-items: center; justify-content: center;">
            <img src="https://jsvan.github.io/cz-econ-presentation/img/vltavacascade.webp" alt="Vltava Cascade - Orlík Dam" style="max-width: 100%; object-fit: contain; border-radius: 4px;">
        </div>
        <div class="data-card" style="margin: 0;">
            <h4>Dlouhé Stráně</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Gigantická baterie postavená uvnitř hory se dvěma jezery.</p>
        </div>
        <div class="data-card" style="margin: 0;">
            <h4>Vltava kaskáda</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Devět přehrad na Vltavě až do Prahy — vyrábí 3 % elektřiny v Česku.</p>
        </div>
    </div>

</div>

<script>
window.initChartsSlide4 = function() {
    // Polish flag-inspired red for Poland
    const polandRed = '#c75050';

    // Industrial electricity prices (EUR/kWh)
    createChart('energyPricesChart', {
        type: 'line',
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
            datasets: [
                {
                    label: 'Německo',
                    data: [0.15, 0.15, 0.15, 0.16, 0.16, 0.16, 0.18, 0.25, 0.32, 0.28],
                    borderColor: ChartColors.gold,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.gold,
                    borderWidth: 2
                },
                {
                    label: 'Česko',
                    data: [0.08, 0.08, 0.07, 0.08, 0.09, 0.09, 0.11, 0.18, 0.22, 0.19],
                    borderColor: ChartColors.blue,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.blue,
                    borderWidth: 3
                },
                {
                    label: 'Polsko',
                    data: [0.09, 0.09, 0.09, 0.10, 0.10, 0.10, 0.12, 0.14, 0.17, 0.18],
                    borderColor: polandRed,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: polandRed,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { color: '#888', usePointStyle: true, padding: 20 }
                }
            },
            scales: {
                y: {
                    title: { display: true, text: 'EUR/kWh' },
                    grid: { color: '#1a1a1a' },
                    min: 0,
                    max: 0.35
                },
                x: { grid: { color: '#1a1a1a' } }
            }
        }
    });

    // Electricity consumption per capita (MWh/person)
    // Population (millions): Germany ~84, Poland ~38, Czechia ~10.5
    // TWh / million people = MWh per person
    createChart('energyConsumptionChart', {
        type: 'line',
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
            datasets: [
                {
                    label: 'Německo',
                    // 600/84=7.1, 595/84=7.1, 590/84=7.0, 580/84=6.9, 570/84=6.8, 550/84=6.5, 560/84=6.7, 540/84=6.4, 515/84=6.1, 510/84=6.1
                    data: [7.1, 7.1, 7.0, 6.9, 6.8, 6.5, 6.7, 6.4, 6.1, 6.1],
                    borderColor: ChartColors.gold,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.gold,
                    borderWidth: 2
                },
                {
                    label: 'Česko',
                    // 62/10.5=5.9, 61/10.5=5.8, 62/10.5=5.9, 63/10.5=6.0, 62/10.5=5.9, 58/10.5=5.5, 60/10.5=5.7, 60/10.5=5.7, 59/10.5=5.6, 60/10.5=5.7
                    data: [5.9, 5.8, 5.9, 6.0, 5.9, 5.5, 5.7, 5.7, 5.6, 5.7],
                    borderColor: ChartColors.blue,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.blue,
                    borderWidth: 3
                },
                {
                    label: 'Polsko',
                    // 150/38=3.9, 152/38=4.0, 156/38=4.1, 160/38=4.2, 158/38=4.2, 155/38=4.1, 165/38=4.3, 168/38=4.4, 170/38=4.5, 171/38=4.5
                    data: [3.9, 4.0, 4.1, 4.2, 4.2, 4.1, 4.3, 4.4, 4.5, 4.5],
                    borderColor: polandRed,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: polandRed,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { color: '#888', usePointStyle: true, padding: 20 }
                }
            },
            scales: {
                y: {
                    title: { display: true, text: 'MWh/osobu' },
                    grid: { color: '#1a1a1a' },
                    min: 0,
                    max: 8
                },
                x: { grid: { color: '#1a1a1a' } }
            }
        }
    });

    // Energy mix 2024 - three pie charts with labels on slices
    // Color schemes: Fossil (dark reds), Low-carbon (blues) - tight range
    const fossilColors = {
        coal: '#7f1d1d',    // dark red
        gas: '#991b1b'      // similar dark red
    };
    const lowCarbonColors = {
        nuclear: '#10b981', // emerald green
        wind: '#4f94f8',    // blue
        solar: '#60a5fa',   // blue
        hydro: '#3b82f6'    // blue (darker)
    };

    // Custom plugin to draw labels on pie slices
    const pieLabelsPlugin = {
        id: 'pieLabels',
        afterDraw: (chart) => {
            const ctx = chart.ctx;
            const meta = chart.getDatasetMeta(0);

            meta.data.forEach((arc, index) => {
                const data = chart.data.datasets[0].data[index];
                if (data < 5) return; // Skip small slices

                const label = chart.data.labels[index];
                const centerAngle = (arc.startAngle + arc.endAngle) / 2;
                const radius = (arc.innerRadius + arc.outerRadius) / 2;

                const x = arc.x + Math.cos(centerAngle) * radius * 1.05;
                const y = arc.y + Math.sin(centerAngle) * radius * 1.05;

                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 11px Source Sans 3, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // Draw text with shadow for readability
                ctx.shadowColor = 'rgba(0,0,0,0.8)';
                ctx.shadowBlur = 3;
                ctx.fillText(label, x, y - 6);
                ctx.font = '10px Source Sans 3, sans-serif';
                ctx.fillText(data + '%', x, y + 6);
                ctx.restore();
            });
        }
    };

    // Data for each country: [Coal, Gas, Nuclear, Wind, Solar, Hydro/Bio]
    const germanyData = [21, 17, 0, 25, 17, 10];
    const czechiaData = [34, 5, 41, 1, 7, 10];
    const polandData = [52, 13, 0, 16, 12, 5];

    const pieLabels = ['Uhlí', 'Plyn', 'Jaderná', 'Vítr', 'Slunce', 'Voda'];
    const pieColors = [
        fossilColors.coal, fossilColors.gas,
        lowCarbonColors.nuclear, lowCarbonColors.wind,
        lowCarbonColors.solar, lowCarbonColors.hydro
    ];

    const pieOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: (ctx) => `${ctx.label}: ${ctx.raw}%`
                }
            }
        }
    };

    createChart('energyMixGermany', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: germanyData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });

    createChart('energyMixCzechia', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: czechiaData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });

    createChart('energyMixPoland', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: polandData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });
};
</script>
