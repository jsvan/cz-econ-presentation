<!-- SLIDE: ENERGY -->
<div class="slide-content">
    <div class="section-number">04</div>
    <div class="section-label">Energy & Climate</div>
    <h2>Czech Energy Infrastructure</h2>

    <div class="map-container">
        <div class="chart-title">Power Generation Facilities — <a href="https://www.cez.cz/en/energy-generation" target="_blank" style="color: var(--accent-gold);">ČEZ</a></div>
        <svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
            <!-- Czech Republic outline -->
            <path d="M50,150 Q80,80 150,60 Q200,40 260,50 Q320,60 380,90 Q430,120 450,160 Q460,200 430,230 Q380,260 320,250 Q260,240 200,250 Q140,260 100,230 Q60,200 50,150 Z" fill="#1a1a1a" stroke="#333" stroke-width="2"/>

            <!-- COAL PLANTS (red region) - North Bohemian Basin -->
            <ellipse cx="125" cy="95" rx="50" ry="22" fill="#7f1d1d" opacity="0.4"/>
            <text x="125" y="78" fill="#ef4444" font-size="8" text-anchor="middle" font-weight="bold">Coal Plants</text>
            <text x="125" y="95" fill="#fff" font-size="7" text-anchor="middle">Prunéřov, Tušimice</text>
            <text x="125" y="106" fill="#fff" font-size="7" text-anchor="middle">Počerady, Ledvice</text>
            <!-- Sokolov coal -->
            <ellipse cx="65" cy="115" rx="18" ry="10" fill="#7f1d1d" opacity="0.3"/>
            <text x="65" y="118" fill="#fff" font-size="6" text-anchor="middle">Tisová</text>
            <!-- Ostrava coal -->
            <ellipse cx="400" cy="155" rx="20" ry="12" fill="#7f1d1d" opacity="0.3"/>
            <text x="400" y="158" fill="#fff" font-size="6" text-anchor="middle">Dětmarovice</text>

            <!-- NUCLEAR (bright blue) - Dukovany -->
            <circle cx="320" cy="210" r="18" fill="#2563eb" opacity="0.5"/>
            <circle cx="320" cy="210" r="8" fill="#2563eb"/>
            <text x="320" y="195" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Dukovany</text>
            <text x="320" y="232" fill="#3b82f6" font-size="7" text-anchor="middle">2000 MW (4 reactors)</text>
            <!-- Temelín -->
            <circle cx="145" cy="205" r="18" fill="#2563eb" opacity="0.5"/>
            <circle cx="145" cy="205" r="8" fill="#2563eb"/>
            <text x="145" y="190" fill="#fff" font-size="10" text-anchor="middle" font-weight="bold">Temelín</text>
            <text x="145" y="227" fill="#3b82f6" font-size="7" text-anchor="middle">2000 MW (2 reactors)</text>

            <!-- PUMPED HYDRO (cyan) - Dlouhé Stráně -->
            <circle cx="365" cy="120" r="12" fill="#06b6d4" opacity="0.5"/>
            <circle cx="365" cy="120" r="5" fill="#06b6d4"/>
            <text x="365" y="108" fill="#fff" font-size="8" text-anchor="middle" font-weight="bold">Dlouhé Stráně</text>
            <text x="365" y="138" fill="#06b6d4" font-size="6" text-anchor="middle">650 MW pumped</text>
            <!-- Dalešice -->
            <circle cx="305" cy="200" r="10" fill="#06b6d4" opacity="0.4"/>
            <circle cx="305" cy="200" r="4" fill="#06b6d4"/>
            <text x="290" y="188" fill="#fff" font-size="7" text-anchor="middle">Dalešice</text>

            <!-- VLTAVA CASCADE (cyan line with reservoir dots) -->
            <path d="M190,135 Q175,160 165,190 Q155,220 140,250" stroke="#06b6d4" stroke-width="2" fill="none" opacity="0.4"/>
            <!-- Lipno (southernmost, largest reservoir) -->
            <circle cx="140" cy="250" r="6" fill="#06b6d4" opacity="0.5"/>
            <circle cx="140" cy="250" r="3" fill="#06b6d4"/>
            <text x="125" y="255" fill="#fff" font-size="6" text-anchor="end">Lipno</text>
            <!-- Orlík (deepest dam, 91m) -->
            <circle cx="155" cy="220" r="5" fill="#06b6d4" opacity="0.5"/>
            <circle cx="155" cy="220" r="2.5" fill="#06b6d4"/>
            <text x="140" y="218" fill="#fff" font-size="6" text-anchor="end">Orlík</text>
            <!-- Slapy -->
            <circle cx="165" cy="195" r="4" fill="#06b6d4" opacity="0.4"/>
            <circle cx="165" cy="195" r="2" fill="#06b6d4"/>
            <text x="150" y="193" fill="#fff" font-size="5" text-anchor="end">Slapy</text>
            <!-- Štěchovice -->
            <circle cx="175" cy="175" r="3" fill="#06b6d4" opacity="0.4"/>
            <circle cx="175" cy="175" r="1.5" fill="#06b6d4"/>
            <!-- Vrané (closest to Prague) -->
            <circle cx="183" cy="158" r="3" fill="#06b6d4" opacity="0.4"/>
            <circle cx="183" cy="158" r="1.5" fill="#06b6d4"/>
            <!-- Kamýk -->
            <circle cx="160" cy="207" r="2.5" fill="#06b6d4" opacity="0.3"/>
            <circle cx="160" cy="207" r="1" fill="#06b6d4"/>
            <text x="178" y="145" fill="#06b6d4" font-size="6" font-weight="bold">Vltava</text>
            <text x="178" y="152" fill="#06b6d4" font-size="6" font-weight="bold">Cascade</text>

            <!-- WIND (light purple/lavender) - Krystofovy Hamry -->
            <circle cx="100" cy="70" r="8" fill="#a855f7" opacity="0.5"/>
            <circle cx="100" cy="70" r="3" fill="#a855f7"/>
            <text x="100" y="58" fill="#fff" font-size="7" text-anchor="middle">Kryštofovy H.</text>
            <!-- Northern wind region -->
            <circle cx="175" cy="65" r="6" fill="#a855f7" opacity="0.4"/>
            <circle cx="175" cy="65" r="2" fill="#a855f7"/>
            <!-- Olomouc wind -->
            <circle cx="350" cy="145" r="5" fill="#a855f7" opacity="0.3"/>
            <circle cx="350" cy="145" r="2" fill="#a855f7"/>

            <!-- SOLAR (yellow) - Ralsko -->
            <circle cx="210" cy="85" r="10" fill="#eab308" opacity="0.5"/>
            <circle cx="210" cy="85" r="4" fill="#eab308"/>
            <text x="210" y="73" fill="#fff" font-size="8" text-anchor="middle" font-weight="bold">Ralsko</text>
            <text x="210" y="100" fill="#eab308" font-size="6" text-anchor="middle">56 MW solar</text>
            <!-- Brno solar -->
            <circle cx="330" cy="185" r="6" fill="#eab308" opacity="0.4"/>
            <circle cx="330" cy="185" r="2" fill="#eab308"/>

            <!-- Mělník coal/biomass (north of Prague) -->
            <circle cx="215" cy="110" r="10" fill="#7f1d1d" opacity="0.4"/>
            <circle cx="215" cy="110" r="4" fill="#7f1d1d"/>
            <text x="232" y="108" fill="#fff" font-size="7">Mělník</text>

            <!-- Prague marker -->
            <circle cx="200" cy="135" r="4" fill="#fff"/>
            <text x="200" y="128" fill="#fff" font-size="7" text-anchor="middle">Prague</text>
        </svg>
        <div class="map-legend" style="display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem;">
            <div class="legend-item"><div class="legend-dot" style="background: #2563eb;"></div>Nuclear — <a href="https://www.cez.cz/en/energy-generation/nuclear-power-plants" class="src" target="_blank">41% of electricity, 4000 MW</a></div>
            <div class="legend-item"><div class="legend-dot" style="background: #7f1d1d;"></div>Coal — <a href="https://lowcarbonpower.org/region/Czechia" class="src" target="_blank">34% of electricity, phase-out 2033</a></div>
            <div class="legend-item"><div class="legend-dot" style="background: #06b6d4;"></div>Hydro — <a href="https://www.cez.cz/en/energy-generation/hydroelectric-power-plants" class="src" target="_blank">Pumped storage + Vltava cascade</a></div>
            <div class="legend-item"><div class="legend-dot" style="background: #eab308;"></div>Solar — 7% and growing</div>
            <div class="legend-item"><div class="legend-dot" style="background: #a855f7;"></div>Wind — ~1% (limited terrain)</div>
        </div>
    </div>

    <div class="data-grid">
        <div class="data-card">
            <h4>The Vltava Cascade</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">A chain of <strong>9 dams</strong> built 1930s–1990s along the Vltava River from South Bohemia to Prague. Includes <a href="https://www.cez.cz/en/energy-generation/hydroelectric-power-plants" class="src" target="_blank">Lipno</a> (largest Czech reservoir), <strong>Orlík</strong> (deepest dam, 91m), and Slapy. Total ~750 MW capacity. Primary purpose: flood control for Prague—but also generates ~3% of Czech electricity.</p>
        </div>
        <div class="data-card">
            <h4>Dlouhé Stráně</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Czechia's engineering marvel: <strong>Europe's largest reversible turbine</strong> (325 MW each, 2 units). Water drops <strong>510m</strong>—the highest head in the country. Built inside a mountain in Moravia. Can go from zero to full power in <strong>100 seconds</strong>, acting as a giant battery for grid stabilization. Listed among the <a href="https://www.cez.cz/en/energy-generation/hydroelectric-power-plants/cez-hydroelectric-power-plants/czech-republic/dlouhe-strane" class="src" target="_blank">"7 Wonders of Czechia"</a>.</p>
        </div>
    </div>

    <h3>The Cost of Power</h3>
    <div style="display: flex; gap: 1rem;">
        <div class="chart-container" style="flex: 1;">
            <div class="chart-title">Industrial Electricity Prices (EUR/kWh) — <a href="https://ec.europa.eu/eurostat/databrowser/view/ten00117/default/table" target="_blank" style="color: var(--accent-gold);">Eurostat</a></div>
            <div class="chart-wrapper">
                <canvas id="energyPricesChart"></canvas>
            </div>
        </div>
        <div class="chart-container" style="flex: 1;">
            <div class="chart-title">Electricity Consumption Per Capita (MWh/person) — <a href="https://ember-energy.org/latest-insights/european-electricity-review-2024/" target="_blank" style="color: var(--accent-gold);">Ember</a></div>
            <div class="chart-wrapper">
                <canvas id="energyConsumptionChart"></canvas>
            </div>
        </div>
    </div>

    <h3>Power Generation Mix (2024)</h3>
    <p>The three countries have radically different energy strategies. Germany bet on <a href="https://www.ise.fraunhofer.de/en/press-media/press-releases/2025/public-electricity-generation-2024-renewable-energies-cover-more-than-60-percent-of-german-electricity-consumption-for-the-first-time.html" class="src" target="_blank">renewables (56%)</a> but shut down nuclear. Czechia relies on <a href="https://lowcarbonpower.org/region/Czechia" class="src" target="_blank">nuclear (41%)</a> as its low-carbon backbone. Poland remains <a href="https://lowcarbonpower.org/region/Poland" class="src" target="_blank">Europe's coal holdout (52%)</a> but is rapidly adding solar.</p>

    <div class="chart-container">
        <div class="chart-title">Electricity Generation Mix 2024 (%) — <a href="https://lowcarbonpower.org" target="_blank" style="color: var(--accent-gold);">Low Carbon Power</a></div>
        <div style="display: flex; justify-content: space-around; align-items: flex-start; gap: 1rem; padding: 1rem 0;">
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-gold);">Germany</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixGermany"></canvas>
                </div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-blue);">Czech Republic</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixCzechia"></canvas>
                </div>
            </div>
            <div style="text-align: center; flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: #c75050;">Poland</div>
                <div style="height: 200px; position: relative;">
                    <canvas id="energyMixPoland"></canvas>
                </div>
            </div>
        </div>
        <div style="display: flex; justify-content: center; gap: 3rem; margin-top: 0.5rem; font-size: 0.9rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="display: inline-block; width: 14px; height: 14px; background: linear-gradient(135deg, #7f1d1d, #991b1b); border-radius: 3px;"></span>
                <span style="color: var(--text-secondary);">Fossil Fuels</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="display: inline-block; width: 14px; height: 14px; background: linear-gradient(135deg, #3b82f6, #6fb3fc); border-radius: 3px;"></span>
                <span style="color: var(--text-secondary);">Low-Carbon</span>
            </div>
        </div>
    </div>

    <div class="industry-highlight">
        <h3>Climate vs. Competitiveness</h3>
        <p style="margin-bottom: 0.5rem;">The EU's carbon border tax (CBAM) and emissions trading are squeezing coal-dependent economies. But Germany's high energy prices are also driving industry abroad—<a href="https://www.reuters.com/business/energy/german-industry-sounds-alarm-high-energy-costs-2024-01-15/" class="src" target="_blank">BASF and others are shifting production to the US and China</a> where power is cheaper.</p>
        <p style="margin-bottom: 0;"><strong>The dilemma:</strong> Decarbonize too slowly and face carbon taxes; decarbonize too fast and lose industry to cheaper regions.</p>
    </div>
</div>

<script>
window.initChartsSlide4 = function() {
    // Polish flag-inspired red for Poland
    const polandRed = '#c75050';

    // Industrial electricity prices (EUR/kWh)
    createChart('energyPricesChart', {
        type: 'line',
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
            datasets: [
                {
                    label: 'Germany',
                    data: [0.15, 0.15, 0.15, 0.16, 0.16, 0.16, 0.18, 0.25, 0.32, 0.28],
                    borderColor: ChartColors.gold,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.gold,
                    borderWidth: 2
                },
                {
                    label: 'Czech Republic',
                    data: [0.08, 0.08, 0.07, 0.08, 0.09, 0.09, 0.11, 0.18, 0.22, 0.19],
                    borderColor: ChartColors.blue,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.blue,
                    borderWidth: 3
                },
                {
                    label: 'Poland',
                    data: [0.09, 0.09, 0.09, 0.10, 0.10, 0.10, 0.12, 0.14, 0.17, 0.18],
                    borderColor: polandRed,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: polandRed,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { color: '#888', usePointStyle: true, padding: 20 }
                }
            },
            scales: {
                y: {
                    title: { display: true, text: 'EUR per kWh' },
                    grid: { color: '#1a1a1a' },
                    min: 0,
                    max: 0.35
                },
                x: { grid: { color: '#1a1a1a' } }
            }
        }
    });

    // Electricity consumption per capita (MWh/person)
    // Population (millions): Germany ~84, Poland ~38, Czechia ~10.5
    // TWh / million people = MWh per person
    createChart('energyConsumptionChart', {
        type: 'line',
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
            datasets: [
                {
                    label: 'Germany',
                    // 600/84=7.1, 595/84=7.1, 590/84=7.0, 580/84=6.9, 570/84=6.8, 550/84=6.5, 560/84=6.7, 540/84=6.4, 515/84=6.1, 510/84=6.1
                    data: [7.1, 7.1, 7.0, 6.9, 6.8, 6.5, 6.7, 6.4, 6.1, 6.1],
                    borderColor: ChartColors.gold,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.gold,
                    borderWidth: 2
                },
                {
                    label: 'Czech Republic',
                    // 62/10.5=5.9, 61/10.5=5.8, 62/10.5=5.9, 63/10.5=6.0, 62/10.5=5.9, 58/10.5=5.5, 60/10.5=5.7, 60/10.5=5.7, 59/10.5=5.6, 60/10.5=5.7
                    data: [5.9, 5.8, 5.9, 6.0, 5.9, 5.5, 5.7, 5.7, 5.6, 5.7],
                    borderColor: ChartColors.blue,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: ChartColors.blue,
                    borderWidth: 3
                },
                {
                    label: 'Poland',
                    // 150/38=3.9, 152/38=4.0, 156/38=4.1, 160/38=4.2, 158/38=4.2, 155/38=4.1, 165/38=4.3, 168/38=4.4, 170/38=4.5, 171/38=4.5
                    data: [3.9, 4.0, 4.1, 4.2, 4.2, 4.1, 4.3, 4.4, 4.5, 4.5],
                    borderColor: polandRed,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 4,
                    pointBackgroundColor: polandRed,
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { color: '#888', usePointStyle: true, padding: 20 }
                }
            },
            scales: {
                y: {
                    title: { display: true, text: 'MWh per person' },
                    grid: { color: '#1a1a1a' },
                    min: 0,
                    max: 8
                },
                x: { grid: { color: '#1a1a1a' } }
            }
        }
    });

    // Energy mix 2024 - three pie charts with labels on slices
    // Color schemes: Fossil (dark reds), Low-carbon (blues) - tight range
    const fossilColors = {
        coal: '#7f1d1d',    // dark red
        gas: '#991b1b'      // similar dark red
    };
    const lowCarbonColors = {
        nuclear: '#3b82f6', // blue
        wind: '#4f94f8',    // blue
        solar: '#60a5fa',   // blue
        hydro: '#6fb3fc'    // blue
    };

    // Custom plugin to draw labels on pie slices
    const pieLabelsPlugin = {
        id: 'pieLabels',
        afterDraw: (chart) => {
            const ctx = chart.ctx;
            const meta = chart.getDatasetMeta(0);

            meta.data.forEach((arc, index) => {
                const data = chart.data.datasets[0].data[index];
                if (data < 5) return; // Skip small slices

                const label = chart.data.labels[index];
                const centerAngle = (arc.startAngle + arc.endAngle) / 2;
                const radius = (arc.innerRadius + arc.outerRadius) / 2;

                const x = arc.x + Math.cos(centerAngle) * radius * 1.05;
                const y = arc.y + Math.sin(centerAngle) * radius * 1.05;

                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 11px Source Sans 3, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // Draw text with shadow for readability
                ctx.shadowColor = 'rgba(0,0,0,0.8)';
                ctx.shadowBlur = 3;
                ctx.fillText(label, x, y - 6);
                ctx.font = '10px Source Sans 3, sans-serif';
                ctx.fillText(data + '%', x, y + 6);
                ctx.restore();
            });
        }
    };

    // Data for each country: [Coal, Gas, Nuclear, Wind, Solar, Hydro/Bio]
    const germanyData = [21, 17, 0, 25, 17, 10];
    const czechiaData = [34, 5, 41, 1, 7, 10];
    const polandData = [52, 13, 0, 16, 12, 5];

    const pieLabels = ['Coal', 'Gas', 'Nuclear', 'Wind', 'Solar', 'Hydro/Bio'];
    const pieColors = [
        fossilColors.coal, fossilColors.gas,
        lowCarbonColors.nuclear, lowCarbonColors.wind,
        lowCarbonColors.solar, lowCarbonColors.hydro
    ];

    const pieOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: (ctx) => `${ctx.label}: ${ctx.raw}%`
                }
            }
        }
    };

    createChart('energyMixGermany', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: germanyData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });

    createChart('energyMixCzechia', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: czechiaData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });

    createChart('energyMixPoland', {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                data: polandData,
                backgroundColor: pieColors,
                borderColor: '#0a0a0a',
                borderWidth: 2
            }]
        },
        plugins: [pieLabelsPlugin],
        options: pieOptions
    });
};
</script>
